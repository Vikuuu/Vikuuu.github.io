---
import PostList from "../../components/astro/writings-list.astro"
import { en } from "../../config"
import MainLayout from "../../layouts/main.astro"
import { getAllWritings } from "../../utils"

const pageMeta = en.pageMeta

const posts = await getAllWritings()

const postsByYear = posts.reduce(
    (acc: Record<string, any[]>, post: any) => {
        const year = new Date(post.data.pubDate).getFullYear().toString()
        if (!acc[year]) {
            acc[year] = []
        }
        acc[year].push(post)
        return acc
    },
    {} as Record<string, any[]>,
)

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a))
---

<MainLayout
    title={pageMeta.writings.title}
    description={pageMeta.writings.description}
    ogImage={pageMeta.writings.ogImage}
>
    {
        years.map((year) => (
            <div class="year-group my-8">
                <h2 class="my-4 text-2xl font-bold">{year}</h2>
                {postsByYear[year].map((post: any) => (
                    <PostList post={post} dateFormat="MM-DD" dateWidth="w-20" />
                ))}
            </div>
        ))
    }
</MainLayout>
